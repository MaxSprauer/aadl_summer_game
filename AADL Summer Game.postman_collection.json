{
	"info": {
		"_postman_id": "e76e9b64-92e8-4575-a98d-774229c5a252",
		"name": "AADL Summer Game",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Login",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "e766d88b-5251-400a-9294-c1fd1bb57b92",
						"exec": [
							"pm.test(\"response is ok\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/x-www-form-urlencoded",
						"type": "text"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "form_build_id",
							"value": "form-QigufFC3__qhtugJoT-d6Na56pecNjv1a2xnZTdBkqU",
							"type": "text"
						},
						{
							"key": "form_id",
							"value": "user_login_form",
							"type": "text"
						},
						{
							"key": "op",
							"value": "Log in",
							"type": "text"
						},
						{
							"key": "name",
							"value": "{{user}}",
							"type": "text"
						},
						{
							"key": "pass",
							"value": "{{pass}}",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "https://aadl.org/user/login",
					"protocol": "https",
					"host": [
						"aadl",
						"org"
					],
					"path": [
						"user",
						"login"
					]
				},
				"description": "Logs on in order to get session cookies.  Set the {{user}} and {{pass}} environment variables to your username and password."
			},
			"response": []
		},
		{
			"name": "Get populated form",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "adca7eb7-78ce-4a0d-ab72-1b3cc0cc3bef",
						"exec": [
							"pm.test(\"response is ok\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Page contains summergame-player-redeem-form\", function () {",
							"    pm.expect(pm.response.text()).to.include(\"summergame-player-redeem-form\");",
							"});",
							"",
							"const $ = cheerio.load(responseBody);",
							"// console.log($('form[id=summergame-player-redeem-form]').html());",
							"",
							"form_build_id = $('input[name=form_build_id]').val();",
							"form_token = $('input[name=form_token]').val();",
							"action_url = $('#summergame-player-redeem-form').attr('action');",
							"",
							"// console.log(\"form_build_id: \" + form_build_id);",
							"// console.log(\"form_token: \" + form_token);",
							"// console.log(\"action_url: \" + action_url);",
							"// $('#summergame-player-redeem-form').submit(); does not work, unfortunately!",
							"",
							"pm.environment.set(\"form_build_id\", form_build_id);",
							"pm.environment.set(\"form_token\", form_token);",
							"pm.environment.set(\"action_url\", action_url);",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "https://aadl.org/summergame/player/0/gamecode?text={{gamecode}}",
					"protocol": "https",
					"host": [
						"aadl",
						"org"
					],
					"path": [
						"summergame",
						"player",
						"0",
						"gamecode"
					],
					"query": [
						{
							"key": "text",
							"value": "{{gamecode}}"
						}
					]
				},
				"description": "This is a shortcut to request a page with the \"submit a code\" form filled out without having the player ID.  Gets the form build constants as well as the player ID embedded in the URL.  Data is passed to next step with environment variables.  The {{gamecode}} variable comes from the CSV file."
			},
			"response": []
		},
		{
			"name": "Post code",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "14403b78-51dd-4633-be39-65214e2f8deb",
						"exec": [
							"pm.test(\"response is ok\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"// No easy way to tell if success -- banner seems to be generated by JS",
							"",
							"const $ = cheerio.load(responseBody);",
							"// table = $('table[class=account-summary]');",
							"// secondRow = $('.account-summary tr').eq(1);",
							"secondField = $('.account-summary tr td').eq(1);",
							"console.log(\"Score: \" + secondField.text());",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/x-www-form-urlencoded",
						"type": "text"
					}
				],
				"body": {
					"mode": "formdata",
					"formdata": [
						{
							"key": "code_text",
							"value": "{{gamecode}}",
							"type": "text"
						},
						{
							"key": "op",
							"value": "Submit",
							"type": "text"
						},
						{
							"key": "form_build_id",
							"value": "{{form_build_id}}",
							"type": "text"
						},
						{
							"key": "form_token",
							"value": "{{form_token}}",
							"type": "text"
						},
						{
							"key": "form_id",
							"value": "summergame_player_redeem_form",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "https://aadl.org{{action_url}}",
					"protocol": "https",
					"host": [
						"aadl",
						"org{{action_url}}"
					]
				},
				"description": "Post game code form using data from previous step.  The {{gamecode}} variable comes from the CSV file."
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "15f856f9-e804-408c-8c59-cb18bf136594",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "7f590726-a50a-4158-8d70-c953655c641e",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"id": "ef8eeb5f-9262-4af8-aa43-a7918dac53b7",
			"key": "user",
			"value": "Your User Name",
			"type": "string"
		},
		{
			"id": "5e8db865-761c-4ee0-8d38-717717e32b86",
			"key": "pass",
			"value": "Your Password",
			"type": "string"
		}
	]
}